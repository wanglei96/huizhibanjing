<template>
	<view>
		 
		<view class="container">
			<block v-for="(item,index) in bookSkuInfoList" :key="index">
				<view class="line60" >
					<view style="float: left;"><image :src="imageRootUrl + 'image/countdown.png'"  class="size50" style="margin-top: 5rpx;"></image></view>
					<view style="float: left;">{{item.year}}</view>
				</view>
				<view class="h20"></view>
				<view class="split_1"></view>
				<view>
					<view v-for="(ite, index) in item.booksList" :key="index" class="booksListPanel">
						<view style="position: relative;height: 100% ;width: 100%;"> <!-- overflow: hidden; -->
							<view style="cursor: pointer;">
								<image :src="ite | toBookImageFilePath" mode="aspectFit" style=" height: 210rpx;display: block;width: 95% ;  border:  2rpx solid rgb(211 211 211); border-radius: 10rpx;"></image>
								<view class="line50 center f24">{{ite.bookName | toName}}</view>
							</view>
						</view>
					</view>
				</view>
				<view class="h50"></view>
			</block>
		</view>
	</view>
</template>

<script>
	import common from "@/js/common.js";
	import config from "@/js/config.js";
	import util from "@/js/util.js";
	let statusBarHeight = uni.getSystemInfoSync().statusBarHeight; // 状态栏 高度
	let that = null;
	export default {
		data() {
			return {
				url:"http://admin.8630.net/WYB/UploadFile/headerTopbg.png",
				imageRootUrl:config.imageRootUrl,//图片地址
				adminRootUrl:config.adminRootUrl +"/",//后端图片地址
				statusBarHeight,// 状态栏 高度
				head_is_fixed:0,
				list:[
					{id:1,time:'2023年11月01日',boosList:[
						{id:1,name:'密码花园2',url:config.imageRootUrl + 'image/common/bookb1.jpg',},{id:2,name:'安徒生童话全集2',url:config.imageRootUrl +'image/common/bookb2.jpg',},
						{id:3,name:'窗边的小豆豆2',url:config.imageRootUrl + 'image/common/bookb3.jpg',},{id:4,name:'夏洛的网2',url:config.imageRootUrl +'image/common/bookb4.jpg',},
						{id:5,name:'柳林风声2',url:config.imageRootUrl + 'image/common/bookb5.jpg',},{id:6,name:'格林童话2',url:config.imageRootUrl +'image/common/bookb6.jpg',},
						{id:5,name:'柳林风声2',url:config.imageRootUrl + 'image/common/bookb7.jpg',}
					]},
					{id:1,time:'2023年11月02日',boosList:[
						{id:1,name:'密码花园2',url:config.imageRootUrl + 'image/common/bookb1.jpg',},{id:2,name:'安徒生童话全集2',url:config.imageRootUrl +'image/common/bookb2.jpg',},
						{id:3,name:'窗边的小豆豆2',url:config.imageRootUrl + 'image/common/bookb3.jpg',},{id:4,name:'夏洛的网2',url:config.imageRootUrl +'image/common/bookb4.jpg',},
						{id:5,name:'柳林风声2',url:config.imageRootUrl + 'image/common/bookb5.jpg',},{id:6,name:'格林童话2',url:config.imageRootUrl +'image/common/bookb6.jpg',},
						{id:5,name:'柳林风声2',url:config.imageRootUrl + 'image/common/bookb7.jpg',}
					]},
					{id:1,time:'2023年11月03日',boosList:[
						{id:1,name:'密码花园2',url:config.imageRootUrl + 'image/common/bookb1.jpg',},{id:2,name:'安徒生童话全集2',url:config.imageRootUrl +'image/common/bookb2.jpg',},
						{id:3,name:'窗边的小豆豆2',url:config.imageRootUrl + 'image/common/bookb3.jpg',},{id:4,name:'夏洛的网2',url:config.imageRootUrl +'image/common/bookb4.jpg',},
						{id:5,name:'柳林风声2',url:config.imageRootUrl + 'image/common/bookb5.jpg',},{id:6,name:'格林童话2',url:config.imageRootUrl +'image/common/bookb6.jpg',},
						{id:5,name:'柳林风声2',url:config.imageRootUrl + 'image/common/bookb7.jpg',}
					]},
					{id:1,time:'2023年11月04日',boosList:[
						{id:1,name:'密码花园2',url:config.imageRootUrl + 'image/common/bookb1.jpg',},{id:2,name:'安徒生童话全集2',url:config.imageRootUrl +'image/common/bookb2.jpg',},
						{id:3,name:'窗边的小豆豆2',url:config.imageRootUrl + 'image/common/bookb3.jpg',},{id:4,name:'夏洛的网2',url:config.imageRootUrl +'image/common/bookb4.jpg',},
						{id:5,name:'柳林风声2',url:config.imageRootUrl + 'image/common/bookb5.jpg',},{id:6,name:'格林童话2',url:config.imageRootUrl +'image/common/bookb6.jpg',},
						{id:5,name:'柳林风声2',url:config.imageRootUrl + 'image/common/bookb7.jpg',}
					]},
				],
				bookSkuInfoList:[],//借阅记录列表
				loadingText: "正在加载...",
				showLoadMore: false,
				pageIndex: 0, //页数
				pageSize: 10, //条数
				pageCount: 0, //最大页数
			};
		},
		onReady() {
			
		},
		onShow() {
			
		},
		onPageScroll(e) {
		    that.head_is_fixed = e.scrollTop > 0 ? 1 : 0
		},
		onPullDownRefresh() { //刷新   //下拉刷新，需要自己在page.json文件中配置开启页面下拉刷新 "enablePullDownRefresh": true
			uni.stopPullDownRefresh();
		},
		onReachBottom() {  //上拉加载，需要自己在page.json文件中配置"onReachBottomDistance"
			if ((that.pageIndex + 1) == that.pageCount) {
				that.loadingText = "没有更多数据了";
			} else if ((that.pageIndex + 1) < that.pageCount) {
				that.pageIndex = that.pageIndex + 1;
				this.showLoadMore = true;
				that.loadingText = "加载更多";
				that.bindData();
			}
		},
		onLoad() {
			that = this;
			that.bookSkuInfoList=[]
			that.bindData(); //
		},
		methods: {
			bindData(){
				var data = {};
				data.memberId = common.getMemberId()
				data.pageIndex = that.pageIndex 
				data.pageSize = that.pageSize 
				data.bookOrderTypeCode = 'Borrow'
				common.call("GetBookOrderItemInfoList", data, function(result) {
					that.bookSkuInfoList.push(...result.data.dataList);
					that.pageCount = result.data.pageCount;
					that.pageIndex = result.data.pageIndex;
					that.pageSize = result.data.pageSize;
					if(that.bookSkuInfoList.length== 0 || that.bookSkuInfoList.length<10){
						that.showLoadMore =true
						that.loadingText="没有更多数据了" 
					}
					console.log(that.bookSkuInfoList)
				});
			},
			clickToBack(){
				uni.navigateBack();
			},
		},
		filters:{
			toName(name){
				if(name == "undefined"){
					return ""
				}else{
					if(name.length >7){
						return name.substring(0,7) + "..."
					}else{
						return name
					}
				}
			},
			toBookImageFilePath(item){
				if(item.imageFilePath !="" && item.imageFilePath !=null){
					return that.adminRootUrl + "/" + item.imageFilePath
				}else{
					return "../../static/image/common/default.jpg"
				}
			}
		}
	};
</script>

<style lang="scss">
	@import url("/css/common.css");
	page {
		background: #5EAC59;
	}
	.container{
		
	}
	.booksListPanel{
		display: inline-block;
		width: 30%;
		// height: 250rpx;
		// line-height: 250rpx;
		height: 210rpx;
		line-height: 210rpx;
		text-align: center;
		font-size: 36rpx;
		margin-left: 2%;
		margin-top: 20rpx;
	}
</style>