<!DOCTYPE html>
<html>
<head>
<title>基础表控制</title>

<meta http-equiv="keywords" content="">
<meta http-equiv="description" content="">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<!--<link rel="stylesheet" type="text/css" href="./styles.css">-->
<link rel="stylesheet" type="text/css"
	href="../../themes/custom/easyui.css" />
<link rel="stylesheet" type="text/css" href="../../themes/icon.css" />
<script type="text/javascript" src="../../js/jquery.js"></script>
<script type="text/javascript" src="../../js/common.js?v=12"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/json2.js"></script>
<script type="text/javascript" src="../../js/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../js/util.js?v=1"></script>
<script type="text/javascript" src="../../js/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../js/jquery.query.js"></script>
<link rel="stylesheet" href="../../css/common.css?v=2" type="text/css"></link>
<link rel="stylesheet" href="../../css/base.css" type="text/css"></link>
<script type="text/javascript" src="../../js/management.js"></script>
<script type="text/javascript">
	managementContext.dataName = "SysBasicTable";
	managementContext.tableName = "sys_basic_table";
	managementContext.title = "基础表管理";
	managementContext.primaryKeyName = "id";
	managementContext.operationColumnWidth = 300;
	
	managementContext.customTableColumns = [ {
		field : 'table_name',
		title : '表名',
		fixed : true,
		width : 200,
		align : 'left'
	}, {
		field : 'sys_basic_table_type_name',
		title : '基础表类型',
		fixed : true,
		width : 150,
		align : 'left'
	}, {
		field : 'title',
		title : '标题',
		fixed : true,
		width : 150,
		align : 'left'
	}, {
		field : 'description',
		title : '描述',
		width : 100,
		align : 'left'
	} ];

	function bindControls() {
		//绑定类型
		bindCodeNameComboBox("cmbSysBasicTableTypeCode", "sys_basic_table_type");
		//菜单类型
		bindCodeNameComboTree("cmbSysMenuTypeCode", "sys_menu_type");
		//上级菜单
		bindIdNameComboTree("ctParentId", "sys_menu");
		//绑定类型查询
		bindCodeNameComboBox("cmbSearchSysBasicTableTypeCode",
				"sys_basic_table_type");
		//绑定字段控件类型
		bindCodeNameComboBox("cmbSysUiControlCode", "sys_ui_control");
		//绑定字段数据类型
		bindCodeNameComboBox("cmbSysFieldDataTypeCode", "sys_field_data_type");
		//绑定居中样式
		bindCodeNameComboBox("cmbSysAlignCode", "sys_align");
		//绑定验证数据类型
		bindCodeNameComboBox("cmbSysValidationDataTypeCode", "sys_validation_data_type");
		
	}
	/*
	 取得请求参数
	 */
	function getParameters() {
		var parameters = getParametersBase();
		return parameters;
	}

	/*
	 * 绑定数据实体
	 */
	function bindEntity(primaryKey) {
		var data = new Object();
		data.id = primaryKey;
		data.tableName = managementContext.tableName;
		call(managementContext.getServiceName, data, function(result) {
			outputEntity(result.data);
			$("#hidBasicTableValue").val(result.data.tableName);
			$("#addFieldFromTableButton").hide();
			$("#addFieldButton").hide();
			$("#batchDeleteFieldButton").hide();
			$("#divFieldTableGrid").hide();
			if(result.data.sysBasicTableTypeCode == "CustomTable"){
				bindFieldTable(result.data.tableName);
				if(managementContext.DialogMode == "edit"){
					$("#addFieldFromTableButton").show();
					$("#addFieldButton").show();
					$("#batchDeleteFieldButton").show();
				}
				$("#divFieldTableGrid").show();
			}
		});
	}

	/*
	 * 取得添加生成脚本按钮Html
	 */
	function getGridSqlButtonHtml(dataItem) {
		var primaryKey = getPrimaryKey(dataItem);
		var buttonId = "btnGeneratingScript_" + primaryKey;
		return "<a id='"
				+ buttonId
				+ "' class='easyui-linkbutton grid_button' href='#' onclick=\"return createSql('"
				+ primaryKey + "')\">生成脚本</a>";
	}

	/*
	 * 取得添加到菜单按钮Html
	 */
	function getGridMenuButtonHtml(dataItem) {
		var primaryKey = getPrimaryKey(dataItem);
		var buttonId = "btnAddToMenuList_" + primaryKey;
		return "<a id='"
				+ buttonId
				+ "' class='easyui-linkbutton grid_button' href='#' onclick=\"return openAddToSysMenu('"
				+ primaryKey + "')\">添加到菜单</a>";
	}
	/*
	 * 取得添加到菜单按钮Html
	 */
	function getGridRelationButtonHtml(dataItem) {
		var primaryKey = getPrimaryKey(dataItem);
		var buttonId = "btnAddRelation_" + primaryKey;
		return "<a id='"
				+ buttonId
				+ "' class='easyui-linkbutton grid_button' href='#' onclick=\"return openRelationDialog('"
				+ dataItem.table_name + "')\">关联</a>";
	}

	/*
	取得操作按钮列表
	 */
	function getOperationButtonHtmlArray(dataItem) {
		var arrOpeartionButtonHtml = getOperationButtonHtmlArrayBase(dataItem);
		var lnkRelationHtml = getGridRelationButtonHtml(dataItem);
		var lnkSqlHtml = getGridSqlButtonHtml(dataItem);
		var lnkAddSysMenuHtml = getGridMenuButtonHtml(dataItem);
		arrOpeartionButtonHtml.push(lnkRelationHtml);
		arrOpeartionButtonHtml.push(lnkSqlHtml);
		arrOpeartionButtonHtml.push(lnkAddSysMenuHtml);
		return arrOpeartionButtonHtml;
	}

	/*
	 生成脚本
	 */
	function createSql(primaryKey) {
		var data = new Object();
		data.id = primaryKey;
		call("GetSysBasicTableSql", data, function(result) {
			var sql = result.data;
			openDialog("divSqlDialog", "数据库脚本", function() {
				$("#txtSql").textbox("setValue", sql);
			});
		});
	}
	function closeDetailSqlDialog() {
		$('#divSqlDialog').dialog('close');
	}
	//新增基础表
	function openAddTableDialog(){
		try{
			//清空字段列表
			$("#fieldTableGrid").datagrid('loadData',{total:0,rows:[]}); 
			$("#addFieldFromTableButton").hide();
			$("#addFieldButton").hide();
			$("#divFieldTableGrid").hide();
			$("#batchDeleteFieldButton").hide();
			$("#sysTableDialog").dialog('close');
		}catch(e){}
		openAddDialog();
	}

	/*
	 * 打开修改对话框
	 */
	function openRelationDialog(tableName) {
		$("#hfTableName").val(tableName);
		openDialog("divRelationDialog", "关联表", function() {
			bindRelationGrid();
		});
	}
	/*
	绑定关联关系表
	 */
	function bindRelationGrid() {
		var data = new Object();
		data.basicTableName = $("#hfTableName").val();
		call("GetSysBasicTableRelationList", data, function(result) {
			outputListGrid(result.data.dataList, "tableRelation", function(
					dataItem) {
				return getRelationGridRow(dataItem);
			}, function() {
				var tableColumns = [ [ {
					field : 'related_table_name',
					title : '关联表',
					fixed : true,
					width : 200,
					align : 'left'
				}, {
					field : 'related_column_name',
					title : '关联字段',
					fixed : true,
					width : 200,
					align : 'left'
				}, {
					field : 'operation',
					title : '操作',
					fixed : true,
					width : 80,
					align : 'center'
				} ] ];
				return tableColumns;
			});
		});
	}
	/*
	取得关联表数据行
	 */
	function getRelationGridRow(dataItem) {
		var lnkDeleteHtml = getRelationGridDeleteButtonHtml(dataItem);
		var operation = "<div class='grid_commands'>" + lnkDeleteHtml
				+ "</div>";
		var gridRow = {
			operation : operation,
			related_table_name : dataItem.related_table_name,
			related_column_name : dataItem.related_column_name
		};
		return gridRow;
	}
	/*
	 * 取得删除按钮Html
	 */
	function getRelationGridDeleteButtonHtml(dataItem) {
		return "<a class='easyui-linkbutton grid_button' href='#' onclick=\"return deleteRelation('"
				+ dataItem.related_table_name
				+ "','"
				+ dataItem.related_column_name
				+ "','"
				+ dataItem.basic_table_name + "')\">删除</a>";
	}
	/*
	删除关系
	 */
	function deleteRelation(relatedTableName, relatedColumnName, basicTableName) {
		if (!confirm("确定要删除吗？")) {
			return;
		}
		var data = new Object();
		data.relatedTableName = relatedTableName;
		data.relatedColumnName = relatedColumnName;
		data.basicTableName = basicTableName;
		call("DeleteSysBasicTableRelation", data, function(result) {
			bindRelationGrid();
		});
	}

	/*
	 打开添加到菜单窗口
	 */
	function openAddToSysMenu(primaryKey) {
		var data = new Object();
		data.id = primaryKey;
		call("GetSysBasicTable", data, function(result) {
			var theSysBasicTable = result.data;
			//菜单名称
			var sysMenuName = getSysMenuName(theSysBasicTable.tableName);
			//基础表管理页面名称
			var pageUrl = getPageUrl(theSysBasicTable.sysBasicTableTypeCode);
			var url = pageUrl + "?tableName=" + theSysBasicTable.tableName
					+ "&title=" + theSysBasicTable.title;
			// 显示
			$('#divAddMenuDetailDialog').dialog({
				title : '新增菜单',
				onOpen : function() {
					$('#txtName').textbox("setValue", theSysBasicTable.title);
					$('#txtValue').textbox("setValue", sysMenuName);
					$('#txtUrl').textbox("setValue", url);
				},
				closed : false
			});
		});

	}

	/*
	取和页面名称
	 */
	function getPageUrl(sysBasicTableTypeCode) {
		var pageUrl = "";
		if (sysBasicTableTypeCode == "CodeNameTable") {
			pageUrl = "views/common/CodeNameTableManagement.htm";
		} else if (sysBasicTableTypeCode == "IdNameTable") {
			pageUrl = "views/common/IdNameTableManagement.htm";
		} else if (sysBasicTableTypeCode == "CodeNameTree") {
			pageUrl = "views/common/CodeNameTreeManagement.htm";
		} else if (sysBasicTableTypeCode == "IdNameTree") {
			pageUrl = "views/common/IdNameTreeManagement.htm";
		} else if (sysBasicTableTypeCode == "CmsIdNameTable") {
			pageUrl = "views/common/CmsIdNameTableManagement.htm";
		} else if (sysBasicTableTypeCode == "CmsCodeNameTable") {
			pageUrl = "views/common/CmsCodeNameTableManagement.htm";
		} else if (sysBasicTableTypeCode == "CmsIdNameTree") {
			pageUrl = "views/common/CmsIdNameTreeManagement.htm";
		} else if (sysBasicTableTypeCode == "CmsCodeNameTree") {
			pageUrl = "views/common/CmsCodeNameTreeManagement.htm";
		} else {
			pageUrl = "views/common/CustomTableManagement.htm";
		}
		return pageUrl;
	}
	/*
	 取得菜单名
	 */
	function getSysMenuName(tableName) {
		var sysMenuName = "";
		var nameParts = tableName.split("_");
		for ( var i = 0; i < nameParts.length; i++) {
			var namePart = nameParts[i];
			sysMenuName += namePart.substr(0, 1).toUpperCase()
					+ namePart.substr(1);
		}
		return sysMenuName;
	}
	/*
	保存添加的菜单
	 */
	function saveSysMenu() {

		var data = getSysMenuEntity();
		call("AddSysMenu", data, function(result) {
			//重置管理员权限
			call("ResetAdminPermissions", null, function(result) {
				showMessage("菜单添加成功,已重置管理员权限。");
				closeDetailDialog();
				$('#divAddMenuDetailDialog').dialog('close');
				refreshControls();
				bindData();
			});
		});

	}

	/*
	 取和菜单实体对象
	 */
	function getSysMenuEntity() {
		var newEntity = getEntityBase("formMenu");
		if ($("#txtDisplayOrder").val() == "") {
			newEntity.displayOrder = 0;
		}
		newEntity.description = $("#txtSysMenuDescription").val();
		return newEntity;
	}

	function closeRelationDialog() {
		$('#divRelationDialog').dialog('close');

	}

	//========================================添加外键关联=================================================
	function openAddRelationDialog() {

		openDialog("divAddRelation", "添加关联关系", function() {
			var data = new Object();
			call("GetAllTables", data, function(result) {
				//alert(JSON.stringify(result));
				outputSelect("selectAllTable", result.data, "TABLE_NAME",
						"TABLE_NAME");
			});
		})

		$('#selectAllTable').on(
				"change",
				function() {
					var data = new Object();
					data.tableName = $('#selectAllTable').val();
					call("GetAllColumns", data, function(result) {
						outputSelect("selectColumns", result.data,
								"COLUMN_NAME", "COLUMN_NAME");
					});

				})

	}

	function closeAddRelationDialog() {
		$('#divAddRelation').dialog('close');
	}

	//=====================================添加sys_basic_table_relation =============================================

	//获取实体
	function getRelationEntity() {
		var newEntity = new Object();
		newEntity.relatedTableName = $("#selectAllTable").val();
		newEntity.relatedColumnName = $("#selectColumns").val();
		newEntity.basicTableName = $("#hfTableName").val();
		return newEntity;
	}

	/*
	 添加关联
	 */
	function addRelation() {
		var data = getRelationEntity();
		call("AddSysBasicTableRelation", data, function(result) {
			bindRelationGrid();
			closeAddRelationDialog();
		});

	}

	/*
	 * 批量生成脚本
	 */
	function createSqls() {
		var selectedRows = $('#tableGrid').datagrid('getSelections');
		if (selectedRows.length == 0) {
			alert("请选择要生成脚本的基础表!");
			return false;
		}
		var ids = [];
		for ( var i = 0; i < selectedRows.length; i++) {
			ids.push(selectedRows[i].id);
		}
		var data = new Object();
		data.ids = ids;
		call("GetSysBasicTableSqls", data, function(result) {
			var sql = result.data;
			openDialog("divSqlDialog", "数据库脚本", function() {
				$("#txtSql").textbox("setValue", sql);
			});
		});
	}
	//=====================================添加sys_basic_table_field =============================================
	
	var fieldContext = new Object();
	fieldContext.DialogMode = "view";
	fieldContext.pageIndex = 0;
	fieldContext.pageSize = 20;
	fieldContext.allowPaging = true;
	
	function bindFieldTable(tableName) {
		var data = new Object();
		data.tableName = "view_sys_basic_table_field";
		data.condition = "table_name = '" + tableName + "'";
		data.pageSize = fieldContext.pageSize;
		data.pageIndex = fieldContext.pageIndex;
		data.orderBy = "display_order";
		call("GetList", data, function(result) {
			outputListGrid(result.data.dataList, "fieldTableGrid",  function(
					dataItem) {
				return getFieldGridRow(dataItem);
			}, function() {
				var tableColumns = [ [ {
					field : 'ck',
					checkbox:true,
					width : 30,
					fixed : true,
					align : 'center'
				},{
					title : '操作',
					field : 'operation',
					width : 200,
					fixed : true,
					align : 'center'
				}, {
					field : 'field_name',
					title : '字段名',
					fixed : true,
					width : 180,
					align : 'center'
				}, {
					field : 'caption',
					title : '标题',
					fixed : true,
					width : 130,
					align : 'center'
				}, {
					field : 'sys_ui_control_name',
					title : '字段类型',
					fixed : true,
					width : 80,
					align : 'center'
				}, {
					field : 'column_span',
					title : '占用列数',
					fixed : true,
					width : 80,
					align : 'center'
				}, {
					field : 'display_order',
					title : '显示顺序',
					fixed : true,
					width : 80,
					align : 'center'
				}, {
					field : 'required',
					title : '是否必填',
					fixed : true,
					width : 80,
					align : 'center',
					formatter:function(value, row, index){
						if(value == 1){
							return "是";
						}
						if(value == 0){
							return "否";
						}
					}
				}, {
					field : 'is_unique',
					title : '是否唯一',
					fixed : true,
					width : 80,
					align : 'center',
					formatter:function(value, row, index){
						if(value == 1){
							return "是";
						}
						if(value == 0){
							return "否";
						}
					}
				} ] ];
				return tableColumns;
			});
			// 设置分页
			if (managementContext.allowPaging) {
				setFieldPager(result.data);
			}
		});		
	}
	
	/*
	 * 设置分页
	 */
	function setFieldPager(data) {
		// 分页
		var pager = $("#fieldTableGrid").datagrid('getPager');
		var tableName = $("#hidBasicTableValue").val();
		pager.pagination('refresh', {
			total : data.recordCount,
			pageSize : data.pageSize,
			pageNumber : fieldContext.pageIndex + 1,
			onSelectPage : function(pageNumber, pageSize) {
				fieldContext.pageIndex = pageNumber - 1;
				fieldContext.pageSize = pageSize;
				$(this).pagination('loading');
				bindFieldTable(tableName);
				$(this).pagination('loaded');
			}
		});
	}
	
	/*
	取得关联表数据行
	 */
	function getFieldGridRow(dataItem) {
		var operationHtml = getFieldOperationHtml(dataItem);
		var gridRow = dataItem;
		gridRow.operation = operationHtml;
		return gridRow;
	}
	/*
	 * 取得操作Html
	 */
	function getFieldOperationHtml(dataItem) {
		var arrOperationButtonHtml = getFieldOperationButtonHtmlArray(dataItem);
		var operationHtml = "<div class='grid_commands'>";
		for ( var i = 0; i < arrOperationButtonHtml.length; i++) {
			operationHtml += arrOperationButtonHtml[i];
		}
		operationHtml += "</div>";
		return operationHtml;
	}
	
	/*
	 * 取得操作按钮列表，默认为查看，修改，删除三个按钮
	 */
	function getFieldOperationButtonHtmlArray(dataItem) {
		var arrOpeartionButtonHtml = new Array();
		var lnkViewHtml = getFieldGridViewButtonHtml(dataItem);
		arrOpeartionButtonHtml.push(lnkViewHtml)
		if(managementContext.DialogMode != "view"){
			var lnkEditHtml = getFieldGridEditButtonHtml(dataItem);
			var lnkDeleteHtml = getFieldGridDeleteButtonHtml(dataItem);
			var moveUpHtml = getGridMoveUpButtonHtml(dataItem);
			var moveDownHtml = getGridMoveDownButtonHtml(dataItem);
			arrOpeartionButtonHtml.push(lnkEditHtml);
			arrOpeartionButtonHtml.push(lnkDeleteHtml);
			arrOpeartionButtonHtml.push(moveUpHtml);
			arrOpeartionButtonHtml.push(moveDownHtml);
		}
		return arrOpeartionButtonHtml;
	}
	
	function getFieldGridViewButtonHtml(dataItem){
		return getFieldButtonHtml(dataItem,"openFieldViewDialog", "查看","View");
	}
	
	function getFieldGridEditButtonHtml(dataItem){
		return getFieldButtonHtml(dataItem,"openFieldEditDialog", "修改","Update");
	}
	
	function getFieldGridDeleteButtonHtml(dataItem){
		return getFieldButtonHtml(dataItem,"deleteField", "删除","Delete");
	}
	
	function getFieldButtonHtml(dataItem,functionName, buttonText,buttonType){
		var lnkViewHtml = "<a  class='easyui-linkbutton grid_button' href='#' onclick=\"return "
				+ functionName + "('" + dataItem.table_name + "','"+ dataItem.field_name +"')\">" + buttonText + "</a>";
		return lnkViewHtml;
	}
		/*
	 * 取得上移按钮Html
	 */
	function getGridMoveUpButtonHtml(dataItem) {
		return "<a class='easyui-linkbutton grid_button' href='#' onclick=\"return moveUpField('"
				+ dataItem.field_name + "','" + dataItem.table_name+ "')\">上移</a>";
	}
	
	/*
	 * 取得下移按钮Html
	 */
	function getGridMoveDownButtonHtml(dataItem) {
		return "<a class='easyui-linkbutton grid_button' href='#' onclick=\"return moveDownField('"
				+ dataItem.field_name + "','" + dataItem.table_name+ "')\">下移</a>";
	}
	function openAddFieldDialog() {
		clearFieldForm();
		// 设置新增模式
		fieldContext.DialogMode = "add";
		removeFieldFormDetailReadonly();
		var tableName = $("#hidBasicTableValue").val();
		$("#FieldformDetail #txtTableName").textbox("setValue", tableName);
		openDialog("divFieldDetailDialog", '新增字段');
	}
	
	function openFieldViewDialog(tableName,fieldName) {
		clearFieldForm();
		// 设置新增模式
		fieldContext.DialogMode = "view";
		setFieldFormDetailReadonly();
		var tableName = $("#hidBasicTableValue").val();
		$("#FieldformDetail #txtTableName").textbox("setValue", tableName);
		bindFieldEntity(tableName,fieldName);
		openDialog("divFieldDetailDialog", '查看字段');
	}
	
	function openFieldEditDialog(tableName,fieldName) {
		clearFieldForm();
		// 设置新增模式
		fieldContext.DialogMode = "updata";
		removeFieldFormDetailReadonly();
		var tableName = $("#hidBasicTableValue").val();
		$("#FieldformDetail #txtTableName").textbox("setValue", tableName);
		bindFieldEntity(tableName,fieldName);
		openDialog("divFieldDetailDialog", '修改字段');
	}
	
	function deleteField(tableName,fieldName) {
		if (!confirm("确定要删除吗？")) {
			return;
		}
		var data = new Object();
		data.tableName = tableName;
		data.fieldName = fieldName;
		call("DeleteSysBasicTableField",data,function(result){
			var tableName = $("#hidBasicTableValue").val();
			bindFieldTable(tableName);
		});
	}
	
	function deleteFields() {
		var selectedRows = $('#fieldTableGrid').datagrid('getSelections');
		if (selectedRows.length == 0) {
			alert("请至少选择一行数据!");
			return false;
		}
		var primaryKeys = [];
		for ( var i = 0; i < selectedRows.length; i++) {
			var primaryKeyItem = new Object();
				primaryKeyItem.tableName = selectedRows[i].table_name;
				primaryKeyItem.fieldName = selectedRows[i].field_name;
				primaryKeys.push(primaryKeyItem);
		}
		var data = new Object();
		data.tableName = managementContext.tableName;
		data.primaryKeys = primaryKeys;
		if (confirm("确定要删除吗?")) {
			call("BatchDeleteSysBasicTableField", data, function(result) {
				var tableName = $("#hidBasicTableValue").val();
				bindFieldTable(tableName);
			});
		}
	}
	
	function getFieldEntity(){
		var newEntity = getEntityBase("FieldformDetail");
		return newEntity;
	}	
	
	function saveField(){
		var data = getFieldEntity();
		if(fieldContext.DialogMode == "add"){
			call("AddSysBasicTableField",data,function(result){
				var tableName = $("#hidBasicTableValue").val();
				bindFieldTable(tableName);
				$("#divFieldDetailDialog").dialog('close');
			})	
		} 
		if(fieldContext.DialogMode == "updata"){
			call("UpdateSysBasicTableField",data,function(result){
				var tableName = $("#hidBasicTableValue").val();
				bindFieldTable(tableName);
				$("#divFieldDetailDialog").dialog('close');
			})	
		} 
	}

	function bindFieldEntity(tableName,fieldName){
		var data = new Object();
		data.tableName = tableName
		data.fieldName = fieldName;
		call("GetSysBasicTableField", data, function(result) {
			outputFieldEntity(result.data);
		});
	}
	
	/*
	 * 设置只读
	 */
	function setFieldFormDetailReadonly() {
		$("#divFieldDetailDialog input[id^=txt]").each(function() {
			$(this).textbox("readonly", true);
		});
	
		$("#divFieldDetailDialog textarea[id^=txt]").each(function() {
			$(this).textbox("readonly", true);
		});
		$("#divFieldDetailDialog input[id^=cmb]").each(function() {
			$(this).combobox("readonly", true);
		});
		$("#divFieldDetailDialog input[id^=ct]").each(function() {
			$(this).combotree("readonly", true);
		});
		$("#divFieldDetailDialog input[id^=chk]").each(function() {
			$(this).attr("disabled", "disabled");
		});
		$("#btnSaveField").hide();
	}
	
	/*
	 * 取消只读
	 */
	function removeFieldFormDetailReadonly() {
		$("#divFieldDetailDialog input[id^=txt]").each(function() {
			$(this).textbox("readonly", false);
		});
	
		$("#divFieldDetailDialog textarea[id^=txt]").each(function() {
			$(this).textbox("readonly", false);
		});
		$("#divFieldDetailDialog input[id^=cmb]").each(function() {
			$(this).combobox("readonly", false);
		});
		$("#divFieldDetailDialog input[id^=ct]").each(function() {
			$(this).combotree("readonly", false);
		});
		$("#divFieldDetailDialog input[id^=chk]").each(function() {
			$(this).removeAttr("disabled");
		});
		$("#btnSaveField").show();
	}

	function outputFieldEntity(dataItem){
		// 给控件赋值
		for ( var key in dataItem) {
			var value = dataItem[key];
			var textboxControlId = getTextBoxControlId(key);
			if ($("#FieldformDetail #" + textboxControlId).size() > 0) {
				$("#FieldformDetail #" + textboxControlId).textbox("setValue", value);
				continue;
			}
			var numberboxControlId = getNumberboxControlId(key);
			if ($("#FieldformDetail #" + numberboxControlId).size() > 0) {
				$("#FieldformDetail #" + numberboxControlId).numberbox("setValue", value);
				continue;
			}
			var hiddenFieldControlId = getHiddenFieldControlId(key);
			if ($("#FieldformDetail #" + hiddenFieldControlId).size() > 0) {
				$("#FieldformDetail #" + hiddenFieldControlId).val(value);
				continue;
			}
			var comboBoxControlId = getComboBoxControlId(key);
			if ($("#FieldformDetail #" + comboBoxControlId).size() > 0) {
				$("#FieldformDetail #" + comboBoxControlId).combobox("setValue", value);
				continue;
			}
			var comboTreeControlId = getComboTreeControlId(key);
			if ($("#FieldformDetail #" + comboTreeControlId).size() > 0) {
				$("#FieldformDetail #" + comboTreeControlId).combotree("setValue", value);
				continue;
			}
			var checkBoxControlId = getCheckBoxControlId(key);
			if ($("#FieldformDetail #" + checkBoxControlId).size() > 0) {
				value = value + "";
				if (value == "1" || value.toLowerCase() == "on"
						|| value.toLowerCase() == "true"
						|| value.toLowerCase() == "yes") {
					$("#FieldformDetail #" + checkBoxControlId).prop("checked", true);
				} else {
					$("#FieldformDetail #" + checkBoxControlId).prop("checked", false);
				}
				continue;
			}
		}
	}
	
	function clearFieldForm(){	
		$("#FieldformDetail").form("clear");
		$("#FieldformDetail #chkEnable").prop("checked", true);
		$("#FieldformDetail #chkShowInForm").prop("checked", true);
	}
	
	function addFieldFromTableButton(){
		var customTable = $("#hidBasicTableValue").val();
		$("#AddCustomTableValue").val(customTable);
		var title = "从表添加到:"+customTable;
		openDialog("sysTableDialog", title);
		searchTables();
	}
	
	function searchTables(){
		var searchKey = $("#searchKey").textbox('getValue');
		var data = new Object();
		data.fields = "table_name,table_schema";
		data.pageSize = "1000";
		data.tableName = "information_schema.tables";
		data.condition = "TABLE_SCHEMA = (select database()) "+ (searchKey==""?"":" and table_name LIKE '%"+searchKey+"%'");
		call("GetList",data,function(result){
			outputListGrid(result.data.dataList, "sysTableGrid",  function(
					dataItem) {
				return getTableGridRow(dataItem);
			}, function() {
				var tableColumns = [ [ {
					title : '操作',
					field : 'operation',
					width : 40,
					fixed : true,
					align : 'center'
				}, {
					field : 'table_name',
					title : '表名',
					fixed : true,
					width : 280,
					align : 'left'
				} ] ];
				return tableColumns;
			});
			$("#sysTableDialog .pagination").hide();
		});	
	}
	
	/*
	取得关联表数据行
	 */
	function getTableGridRow(dataItem) {
		var operationHtml = getTableOperationHtml(dataItem);
		var gridRow = dataItem;
		gridRow.operation = operationHtml;
		return gridRow;
	}
	/*
	 * 取得操作Html
	 */
	function getTableOperationHtml(dataItem) {
		var operationHtml = "<div class='grid_commands'>";
		operationHtml += "<input id='"+dataItem.table_name+","+dataItem.table_schema+"' class='tableChekcBox' type='radio' name='chooseTable' />";
		operationHtml += "</div>";
		return operationHtml;
	}
	
	
	function saveFieldFromTable(){
		var id = $("input[name=chooseTable]:checked").attr("id");
		var idArr = id.split(",");
		var data = new Object();
		data.tableName = idArr[0];
		data.tableSchema = idArr[1];
		data.customTable = $("#AddCustomTableValue").val();
		call("AddCustomTableFieldFromTable",data,function(result){
			var tableName = $("#hidBasicTableValue").val();
			bindFieldTable(tableName);
			$("#sysTableDialog").dialog('close');
		})
	}
	function moveDownField(fieldName,tableName){
		moveField("MoveDown",fieldName,tableName);
	}
	function moveUpField(fieldName,tableName){
		moveField("MoveUp",fieldName,tableName);
	}
	
	/*
	 * 移动数据
	 */
	function moveField(moveDirection, fieldName, tableName) {
		var data = new Object();
		data.fieldName = fieldName;
		data.tableName = tableName;
		data.moveDirection = moveDirection;
		call("MoveCustomField", data, function(result) {
			var tableName = $("#hidBasicTableValue").val();
			bindFieldTable(tableName);
		});
		event.stopPropagation();
	}
</script>
</head>

<body>
	<div class="easyui-layout" style="width:100%;" fit="true">
		<div id="content" region="center" style="padding:1px;">
			<div class="toolbar_panel" id="divToolbar">
				<a href="#" class="easyui-linkbutton" iconCls="icon-add"
					plain="true" onclick="openAddTableDialog()" id="btnAdd">新增</a> <a
					href="#" class="easyui-linkbutton" iconCls="icon-remove"
					plain="true" onclick="deleteDataItems()" id="btnBatchDelete">删除</a>
				<a id="lnkCreateSqls" href="#" class="easyui-linkbutton"
					iconCls="icon-edit" plain="true" onclick="createSqls();">生成脚本</a> <a
					id="lnkRefreshPage" href="#" class="easyui-linkbutton"
					iconCls="icon-reload" plain="true" onclick="refreshPage()">刷新</a>
			</div>

			<!-- 
			input框中的id值名称必须为txtSearch.....
			
			 -->

			<div id="divSearchPanel" class="search_panel easyui-panel">
				<div class="search_item">
					<span class="search_item_caption">表名:</span> <input
						id="txtSearchBasicTableName" class="search_item_textbox easyui-textbox">
				</div>
				<div class="search_item">

					<span class="search_item_caption">标题:</span> <input
						id="txtSearchTitle" class="search_item_textbox easyui-textbox">
				</div>
				<div class="search_item">
					<span class="search_item_caption">基础表类型:</span> <input
						id="cmbSearchSysBasicTableTypeCode"
						class="search_item_textbox easyui-combobox" />
				</div>
				<div class="search_item_command">
					<a href="#" class="easyui-linkbutton" plain="true"
						iconCls="icon-search" onclick="query()">查询</a>
				</div>

			</div>
			<table id="tableGrid">
			</table>
		</div>
	</div>

	<div id="divDetailDialog" class="easyui-dialog"
		style="width:1020px;height:730px;" closed="true"
		buttons="#divBasicDetailCommandBar">
		<div id="divMenuTabs" class="easyui-tabs"
			style="width:980px;height:640px;" closed="true">
			<div title="基本信息" style="padding-left:20px;display:none;">
				<form id="formDetail" method="post" novalidate
					style="margin:0;padding:20px 20px">
					<div style="margin-bottom:10px">
						<input id="txtTableName" name="txtTableName"
							class="easyui-textbox" label="表名" style="width:100%">
					</div>
					<div style="margin-bottom:10px">
						<input id="txtTitle" name="txtTitle" class="easyui-textbox"
							label="标题" style="width:100%">
					</div>
					<div style="margin-bottom:10px">
						<input id="cmbSysBasicTableTypeCode"
							name="cmbSysBasicTableTypeCode" class="easyui-combobox"
							label="基础表类型" style="width:100%">
					</div>
					<div style="margin-bottom:10px">
						<input id="txtDescription" name="txtDescription"
							class="easyui-textbox" label="描述:" multiline="true"
							labelPosition="left" style="width:100%;height:120px;">
					</div>
				</form>
			</div>
			<div title="字段信息" style="overflow:auto;padding:10px;display:none;">
				<input type="hidden" id="hidBasicTableValue" value="" /><a
					id="addFieldButton" href="#" class="easyui-linkbutton addFunction"
					plain="true" onclick="openAddFieldDialog()" style="display: none">添加字段</a> <a
					id="addFieldFromTableButton" href="#"
					class="easyui-linkbutton addFunction" plain="true"
					onclick="addFieldFromTableButton()" style="display: none">从表添加</a> <a
					href="#" class="easyui-linkbutton" iconCls="icon-remove" id = "batchDeleteFieldButton"
					plain="true" onclick="deleteFields()" >删除</a>
				<div id="divFieldTableGrid">
					<table id="fieldTableGrid">
					</table>
				</div>
			</div>
		</div>
	</div>
	<div id="divBasicDetailCommandBar" class="detail_commandbar">
		<a href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-ok" onclick="save()" style="width:90px"
			id="btnSave">保存</a> <a href="javascript:void(0)"
			class="easyui-linkbutton" iconCls="icon-cancel"
			onclick="javascript:$('#divDetailDialog').dialog('close')"
			style="width:90px">取消</a>
	</div>

	<div id="divFieldDetailDialog" class="easyui-dialog"
		style="width:810px;height:595px;" closed="true"
		buttons="#divFieldDetailCommandBar">
		<form id="FieldformDetail" method="post" novalidate
			style="margin:0;">
			<div id="divFieldTabs" class="easyui-tabs"
				style="width:780px;height:500px;" closed="true">
				<div title="基本信息" style="display:none;padding:20px">
					<div class="form_item" style="display:none">
						<div class="form_item_caption">
	                        <span>表名称:</span>
	                    </div>
	                    <div class="form_item_value">
							<input id="txtTableName" name="txtTableName"
								class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>字段名称:</span>
	                    </div>
	                    <div class="form_item_value">
							<input id="txtFieldName" name="txtFieldName"
								class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>标题:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="txtCaption" name="txtCaption"
	                     		class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>控件类型:</span>
	                    </div>
	                    <div class="form_item_value">
							<input id="cmbSysUiControlCode" name="cmbSysUiControlCode"
								class="easyui-combobox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>数据源表名:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="txtDatasourceTableName" name="txtDatasourceTableName" 
	                     		class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>数据源字段名:</span>
	                    </div>
	                    <div class="form_item_value">
							<input id="txtDatasourceValueField" name="txtDatasourceValueField"
								class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>数据源文本字段名:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="txtDatasourceTextField" name="txtDatasourceTextField" 
	                     		class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>数据源查询条件:</span>
	                    </div>
	                    <div class="form_item_value">
							<input id="txtDatasourceCondition" name="txtDatasourceCondition"
								class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>数据源排序:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="txtDatasourceOrderBy" name="txtDatasourceOrderBy" 
	                     		class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item_full">
						<div class="form_item_full_caption">
	                        <span>显示顺序:</span>
	                    </div>
	                    <div class="form_item_full_value">
							<input id="numDisplayOrder" name="numDisplayOrder"
								class="easyui-numberbox" style="width:41%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>隐藏:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkHidden" name="chkHidden" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>主键:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkIsPrimaryKey" name="chkIsPrimaryKey" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>自增:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkIsAutoIncrease" name="chkIsAutoIncrease" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>启用:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkEnable" name="chkEnable" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>字段精度:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numFieldPrecision" name="numFieldPrecision" 
	                     		class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>字段数据类型:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="cmbSysFieldDataTypeCode" name="cmbSysFieldDataTypeCode" 
	                     		class="easyui-combobox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>字段长度:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numFieldLength" name="numFieldLength" 
	                     		class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>小数点位数:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numFieldScale" name="numFieldScale" 
	                     		class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item_full">
						<div class="form_item_full_caption">
	                        <span>备注:</span>
	                    </div>
	                    <div class="form_item_full_value">
	                    	<input id="txtRemark" name="txtRemark" class="easyui-textbox"
	                    		multiline="true" labelPosition="left"
								style="width:100%;height:100px;">
						</div>
					</div>
				</div>
				<div title="字段样式" style="overflow:auto;display:none;padding:20px">
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>占用表单列数:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numColumnSpan" name="numColumnSpan" 
	                     		class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>表单项宽度:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numFormItemWidth" name="numFormItemWidth" 
	                     		 class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>表单项高度:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numFormItemHeight" name="numFormItemHeight" 
	                     		class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>列表项宽度:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numListItemWidth" name="numListItemWidth" 
	                     		class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>格式化字符串:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="txtFormatString" name="txtFormatString" 
	                     		class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>对齐方式:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="cmbSysAlignCode" name="cmbSysAlignCode" 
	                     		class="easyui-combobox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>在表单中显示:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkShowInForm" name="chkShowInForm" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>在列表中显示:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkShowInGrid" name="chkShowInGrid" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>在查询条件中显示:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkShowInQuery" name="chkShowInQuery" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
				</div>
				<div title="字段验证信息" style="overflow:auto;display:none;padding:20px">
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>最大值:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="txtMaxValue" name="txtMaxValue" 
	                     		class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>最小值:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="txtMinValue" name="txtMinValue" 
	                     		class="easyui-textbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>最大字符数:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numMaxLength" name="numMaxLength" 
	                     		class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>最小字符数:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="numMinLength" name="numMinLength" 
	                     		class="easyui-numberbox" style="width:100%;height:100%;">
						</div>
					</div>
					<div class="form_item_full">
						<div class="form_item_full_caption">
	                        <span>验证数据类型:</span>
	                    </div>
	                    <div class="form_item_full_value">
	                    	<input id="cmbSysValidationDataTypeCode" name="cmbSysValidationDataTypeCode" 
	                     		class="easyui-combobox" style="width:41%;height:100%;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>是否必填:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkRequired" name="chkRequired" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
					<div class="form_item">
						<div class="form_item_caption">
	                        <span>是否唯一:</span>
	                    </div>
	                    <div class="form_item_value">
	                    	<input id="chkIsUnique" name="chkIsUnique" type="checkbox"
	                     		class="formCheckbox" style="width:14px;height:14px;">
						</div>
					</div>
					</div>
				</div>
		</form>
		<div id="divFieldDetailCommandBar" class="detail_commandbar">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-ok" onclick="saveField()" style="width:90px"
				id="btnSaveField">保存</a> <a href="javascript:void(0)"
				class="easyui-linkbutton" iconCls="icon-cancel"
				onclick="javascript:$('#divFieldDetailDialog').dialog('close')"
				style="width:90px">取消</a>
		</div>
	</div>
	
	<!-- 从表添加 -->
	<div id="sysTableDialog" closed="true" class="easyui-dialog sysTablePanel" 
		style="width:350px; height:600px;" buttons="#divAddFiledByTableDialogButtons">
			<input type="hidden" id="AddCustomTableValue"/>
			<input class="easyui-textbox" style="width:100px"
					 id="searchKey" textField="text">
			<a href="#" class="easyui-linkbutton" iconCls="icon-search" id="searchTables" onclick="searchTables()">搜索</a>
		<div>
			<table id="sysTableGrid" class="table table-bordered table-hover" style="height:500px;">
			</table>
		</div>
		<div id="divAddFiledByTableDialogButtons">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-add" onclick="saveFieldFromTable()" style="width:90px;"
				id=btnSaveTable>保存</a> <a href="#" class="easyui-linkbutton"
				iconCls="icon-cancel" onclick="javascript:$('#sysTableDialog').dialog('close');"
				style="width:90px">取消</a>
		</div>
	</div>

	<!-- Sql信息 -->
	<div id="divSqlDialog" class="easyui-dialog" style="width:450px"
		closed="true" buttons="#divSqlDialogButtons">
		<form>
			<input id="txtSql" name="txtSql" class="easyui-textbox" label=""
				multiline="true" labelPosition="top"
				style="width:100%;height:200px;" />
		</form>
		<div id="divSqlDialogButtons">
			<a href="#" class="easyui-linkbutton" iconCls="icon-cancel"
				onclick="javascript:closeDetailSqlDialog();" style="width:90px">关闭</a>
		</div>
	</div>
	<!-- 添加到菜单信息 -->
	<div id="divAddMenuDetailDialog" class="easyui-dialog"
		style="width:800px;min-height:500px" closed="true" buttons="#divDetailCommandBar">
		<form id="formMenu" method="post" novalidate class="formDetail">	
			<div class="form_item">
				<div class="form_item_caption">
                       <span>名称:</span>
                   </div>
                   <div class="form_item_value">
                   	<input id="txtName" name="txtName" class="easyui-textbox" 
                   		labelPosition="left" style="width:100%;height:100%;">
				</div>
			</div>
			<div class="form_item">
				<div class="form_item_caption">
                       <span>菜单值:</span>
                   </div>
                   <div class="form_item_value">
                   	<input id="txtValue" name="txtValue" class="easyui-textbox" 
                   		labelPosition="left" style="width:100%;height:100%;">
				</div>
			</div>
			<div class="form_item">
				<div class="form_item_caption">
                       <span>地址:</span>
                   </div>
                   <div class="form_item_value">
                   	<input id="txtUrl" name="txtUrl" class="easyui-textbox" 
                   		labelPosition="left" style="width:100%;height:100%;">
				</div>
			</div>
			<div class="form_item">
				<div class="form_item_caption">
                       <span>菜单类型:</span>
                   </div>
                   <div class="form_item_value">
                   	<input id="cmbSysMenuTypeCode" name="cmbSysMenuTypeCode" class="easyui-combobox" 
                   		labelPosition="left" style="width:100%;height:100%;">
				</div>
			</div>
			<div class="form_item">
				<div class="form_item_caption">
                       <span>上级菜单:</span>
                   </div>
                   <div class="form_item_value">
                   	<input id="ctParentId" name="ctParentId" class="easyui-combotree" 
                   		labelPosition="left" style="width:100%;height:100%;">
				</div>
			</div>
			<div class="form_item">
				<div class="form_item_caption">
                       <span>显示顺序:</span>
                   </div>
                   <div class="form_item_value">
                   	<input id="txtDisplayOrder" name="txtDisplayOrder" class="easyui-textbox" 
                   		labelPosition="left" style="width:100%;height:100%;">
				</div>
			</div>
			<div class="form_item_full">
				<div class="form_item_full_caption">
                       <span>描述:</span>
                   </div>
                   <div class="form_item_full_value">
                   	<input id="txtSysMenuDescription" name="txtSysMenuDescription" class="easyui-textbox" 
                   		multiline="true" labelPosition="left" style="width:100%;height:120px;">
				</div>
			</div>
		</form>
		<div id="divDetailCommandBar" class="detail_commandbar">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-ok" onclick="saveSysMenu()" style="width:90px"
				id="btnSave">保存</a> <a href="javascript:void(0)"
				class="easyui-linkbutton" iconCls="icon-cancel"
				onclick="javascript:$('#divAddMenuDetailDialog').dialog('close')"
				style="width:90px">取消</a>
		</div>
	</div>
	<!-- 查看外键 -->
	<div id="divRelationDialog" class="easyui-dialog"
		style="width:500px;height:366px" closed="true"
		buttons="#divRelationDialogButtons">
		<table id="tableRelation">
		</table>
		<input type="hidden" id="hfTableName" />
		<div id="divRelationDialogButtons">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-sum" onclick="openAddRelationDialog();"
				style="width:90px;" id="btnSaveRelation">添加关联</a> <a href="#"
				class="easyui-linkbutton" iconCls="icon-cancel"
				onclick="javascript:closeRelationDialog();" style="width:90px">关闭</a>
		</div>
	</div>

	<!-- 添加外键关联  -->
	<div id="divAddRelation" class="easyui-dialog" style="width:600px;"
		closed="true" buttons="#divAddRelationDialogButtons">
		<form>
			<span style="position: relative;bottom: 70px;"> 表名 </span> <select
				id="selectAllTable" size="10" style="width:250px;height:185px;">
			</select> <span style="position: relative;bottom: 70px;"> 字段名 </span> <select
				id="selectColumns" size="10"
				style="width:250px;height:185px;margin-left:5px;">

			</select>
		</form>
		<div id="divAddRelationDialogButtons">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-add" onclick="addRelation()" style="width:90px;"
				id="btnSaveRelation">保存</a> <a href="#" class="easyui-linkbutton"
				iconCls="icon-cancel" onclick="javascript:closeAddRelationDialog();"
				style="width:90px">取消</a>
		</div>
	</div>
</body>
</html>