<!DOCTYPE html>
<html>
<head>
<title>基础表控制</title>

<meta http-equiv="keywords" content="">
<meta http-equiv="description" content="">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<!--<link rel="stylesheet" type="text/css" href="./styles.css">-->
<link rel="stylesheet" type="text/css"
	href="../../themes/custom/easyui.css" />
<link rel="stylesheet" type="text/css" href="../../themes/icon.css" />
<script type="text/javascript" src="../../js/jquery.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/json2.js"></script>
<script type="text/javascript" src="../../js/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../js/util.js"></script>
<script type="text/javascript" src="../../js/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../js/jquery.query.js"></script>
<link rel="stylesheet" href="../../css/common.css?v=2" type="text/css"></link>
<link rel="stylesheet" href="../../css/base.css" type="text/css"></link>
<script type="text/javascript" src="../../js/management.js"></script>
<script type="text/javascript">
	managementContext.dataName = "SysOperationLog";
	managementContext.tableName = "view_sys_operation_log";
	managementContext.primaryKeyName = "id";
	managementContext.operationColumnWidth = 300;
	managementContext.customTableColumns = [ [{
			field : 'ck',
			checkbox : true,
			title : 'Code',
			width : 30
		},{
			field : 'operation',
			title : '操作',
			fixed : true,
			width : 100,
			align : 'center'
		}, {
			field : 'operation_type_name',
			title : '操作类型',
			fixed : true,
			width : 100,
			align : 'center'
		}, {
			field : 'operation_target_name',
			title : '操作记录类型',
			fixed : true,
			width : 150,
			align : 'center'
		}, {
			field : 'content',
			title : '内容变更',
			fixed : true,
			width : 450,
			align : 'left'
		}, {
			field : 'operator_true_name',
			title : '操作人',
			width : 100,
			align : 'left'
		}, {
			field : 'operate_time',
			title : '操作时间',
			width : 100,
			align : 'left',
			formatter:function(value, row, index){
					return (new Date(value.time)).Format("yyyy-MM-dd hh:mm:ss");
				}
		}, {
			field : 'operation_target_primary_key',
			title : '操作记录编号',
			width : 100,
			align : 'left'
		}] ];
	/*
	 * 取得数据表列
	 */
	function getTableColumnsBase() {
		return managementContext.customTableColumns;
	}
	
	/*
	 * 绑定控件
	 */
	function bindControls() {
		bindControlsBase();
		//绑定操作类型
		bindCodeNameComboBox("cmbSearchOperationTypeName","sys_operation_type");
		//绑定窗口的操作类型
		bindCodeNameComboBox("cmbOperationTypeCode","sys_operation_type");
		//绑定窗口的操作记录类型
		bindCodeNameComboBox("cmbOperationTargetCode","sys_operation_target");
		//绑定窗口的操作人
		bindComboBox("cmbOperatorId", "sys_user", "id", "true_name", "create_time desc", "　","");
	}
	
	/*
	 * 绑定数据
	 */
	function bindData() {
		var requestParameters = getParameters();
		requestParameters.orderBy = "operate_time desc";
		requestParameters.condition = "operation_target_code = '"+$.query.get("tableName")+"'";
		call(managementContext.getListServiceName, requestParameters, function(
				result) {
			outputData(result.data.dataList);
			//设置功能权限
			bindTableGridFunctionPermission();
			// 设置分页
			if (managementContext.allowPaging) {
				setPager(result.data);
			}
		});
	}
	
	/*
	 * 取得操作按钮,查看按钮
	 */
	function getOperationButtonHtmlArrayBase(dataItem) {
		var arrOpeartionButtonHtml = new Array();
		var lnkViewHtml = getGridViewButtonHtml(dataItem);
		arrOpeartionButtonHtml.push(lnkViewHtml);
		return arrOpeartionButtonHtml;
	}
	/*
	 * 取得查看按钮Html
	 */
	function getGridViewButtonHtml(dataItem) {
		return getGridButtonHtml(dataItem, "openViewDialog", "查看");
	}
	/*
	 * 输出窗实体信息
	 */
	function outputEntity(dataItem) {
		dataItem.operateTime = new Date(dataItem.operateTime.time).Format("yyyy-MM-dd hh:mm:ss");
		outputEntityBase(dataItem);
	}
</script>
</head>

<body>
	<div class="easyui-layout" style="width:100%;" fit="true">
		<div id="content" region="center" style="padding:1px;">
			<div class="toolbar_panel" id="divToolbar">
				<a id="lnkRefreshPage" href="#"
					class="easyui-linkbutton" iconCls="icon-reload" plain="true"
					onclick="refreshPage()">刷新</a>
			</div>

			<!-- 
			input框中的id值名称必须为txtSearch.....
			
			 -->

			<div id="divSearchPanel" class="search_panel easyui-panel">
				<div class="search_item">
					<span class="search_item_caption">操作类型:</span> <input
						id="cmbSearchOperationTypeName" class="search_item_textbox easyui-combobox">
				</div>
				<div class="search_item">

					<span class="search_item_caption">操作人:</span> <input
						id="txtSearchOperatorTrueName" class="search_item_textbox easyui-textbox">
				</div>
				<div class="search_item">
					<span class="search_item_caption">操作时间:</span> <input
						id="txtSearchOperateTime"
						class="search_item_textbox easyui-datebox" />
				</div>
				<div class="search_item_command">
					<a href="#" class="easyui-linkbutton" plain="true"
						iconCls="icon-search" onclick="query()">查询</a>
				</div>

			</div>
			<table id="tableGrid">
			</table>
		</div>
	</div>
	<!-- 基本信息 -->
	<div id="divDetailDialog" class="easyui-dialog" style="width:450px"
		closed="true" buttons="#dlg-buttons">
		<div title="基本信息" data-options="closable:false" style="padding:10px">
			<form id="formDetail" method="post" novalidate
				style="margin:0;padding:20px 20px">
				<div style="margin-bottom:10px">
					<input id="cmbOperationTypeCode" name="cmbOperationTypeCode" class="easyui-combobox"
						label="操作类型" style="width:100%">
				</div>
				<div style="margin-bottom:10px">
					<input id="cmbOperationTargetCode" name="cmbOperationTypeCode" class="easyui-combobox"
						label="操作记录类型" style="width:100%">
				</div>
				<div style="margin-bottom:10px">
					<input id="txtContent" name=""txtContent""
						class="easyui-textbox" label="内容变更:" multiline="true"
						labelPosition="left" style="width:100%;height:150px;">
				</div>
				<div style="margin-bottom:10px">
					<input id="cmbOperatorId"
						name="cmbOperatorId" class="easyui-combobox"
						label="操作人" style="width:100%">
				</div>
				<div style="margin-bottom:10px">
					<input id="txtOperateTime"
						name="txtOperateTime" class="easyui-textbox"
						label="操作时间" style="width:100%">
				</div>
				<div style="margin-bottom:10px">
					<input id="txtPrimaryKey"
						name="txtPrimaryKey" class="easyui-textbox"
						label="操作记录编号" style="width:100%">
				</div>
			</form>
		</div>

		<div id="dlg-buttons">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-ok" onclick="save()" style="width:90px" id="btnSave">保存</a>
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-cancel" onclick="javascript:closeDetailDialog();"
				style="width:90px">取消</a>
		</div>
	</div>
</body>
</html>