<!DOCTYPE html>
<html>
<head>
<title>模板管理的编辑界面</title>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css"
	href="../../tcustom/easyui.cssui.css" />
<link rel="stylesheet" type="text/css" href="../../themes/icon.css" />
<script type="text/javascript" src="../../js/jquery.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/json2.js"></script>
<script type="text/javascript" src="../../js/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../js/util.js?v=1"></script>
<script type="text/javascript" src="../../js/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../js/jquery.query.js"></script>
<script type="text/javascript" src="../../js/jquery.uploader.js"></script>
<link rel="stylesheet" href="../../css/common.css?v=2" type="text/css"></link>
<link rel="stylesheet" href="../../css/base.css" type="text/css"></link>
<script type="text/javascript" src="../../js/management.js?v=12"></script>

<link rel="stylesheet" href="../../js/CodeMirror/css/codemirror.css"
	type="text/css"></link>
<script type="text/javascript" src="../../js/CodeMirror/codemirror.js"></script>
<script type="text/javascript" src="../../js/CodeMirror/xml/xml.js"></script>
<script type="text/javascript" src="../../js/CodeMirror/css/css.js"></script>

<style type="text/css">
.CodeMirror-line-numbers {
	width: 22px;
	color: #aaa;
	background-color: #eee;
	text-align: right;
	padding-right: .3em;
	font-size: 10pt;
	font-family: monospace;
	padding-top: .4em;
	line-height: 16px;
}
</style>

<script type="text/javascript">
	managementContext.dataName = "CmsTemplate";
	managementContext.tableName = "cms_template";
	var editor = null;
	function bindControls() {

	}
	/*
	 * 绑定数据
	 */
	function bindData() {
		var flag = $.cookie("view")
		var primaryKey = $.cookie("cmsTempalteId");

		if (flag != null || flag != "") {

			if (flag == "view") {
				// 设置查看模式
				setViewMode();
				// 绑定数据实体
				bindEntity(primaryKey);
			} else if (flag == "add") {
				// 设置新增模式
				// 取消只读
				removeReadonly();
				bindControls();
			} else if (flag == "edit") {

				// 设置修改模式
				setEditMode();
				// 绑定实体
				bindEntity(primaryKey);

			}

		}

	}
	/*
	 * 输出实体信息
	 */
	function outputEntity(dataItem) {
		outputEntityBase(dataItem);
		editor.setValue(dataItem.templateContent);
	}
	/*
	 * 保存
	 */
	function save() {
		var cmsTemplateParentId = $.cookie("cmsTemplateParentId");
		var cmsSiteId = $.cookie("cmsSiteId");
		var createdFileExtName = $("#createdFileExtNameDropDownList").val();
		var encode = $("#encode").val();
		var data = getEntity();
		data.templateContent = editor.getValue();
		data.parentId = cmsTemplateParentId;
		data.cmsSiteId = cmsSiteId;
		data.createdFileExtName = createdFileExtName;
		data.encode = encode;
		if (isEditMode()) {
			//alert(JSON.stringify(data));

			call(managementContext.updateServiceName, data, function(result) {

				/* refreshControls();
				bindData(); */
			});
		} else {

			//alert(JSON.stringify(data));
			/* 			call(managementContext.addServiceName, data, function(result) {
			
			 refreshControls();
			 bindData();
			 }); */
		}
	}

</script>

</head>

<body>
	<div id="editContent" class="easyui-layout"
		style="width:100%;overflow:auto;" fit="true">
		<div buttons="#dlg-buttons">
			<form id="formDetail" method="post" novalidate
				style="margin:0;padding:20px 50px">

				<div style="margin-bottom:20px">
					<input id="txtName" name="txtName" class="easyui-textbox"
						label="模板名称:" style="width:40%">
				</div>
				<div style="margin-bottom:20px">
					<input id="txtRelatedFileName" name="txtRelatedFileName"
						class="easyui-textbox" label="模板文件:" style="width:40%">
				</div>

				<div style="margin-bottom:20px">
					<input id="txtCreatedFileName" name="txtCreatedFileName"
						class="easyui-textbox" label="生成文件名:" labelPosition="left"
						style="width:40%;">
				</div>
				<div style="margin-bottom:20px;display:none;">
					<input id="txtCmsTemplateTypeCode" name="txtCmsTemplateTypeCode"
						class="easyui-textbox" label="栏目类型" "
							labelPosition="left"
						style="width:40%;">
				</div>
				<div style="margin-bottom:20px">
					<div style="float:left;">
						<span style="display:block;width:105px;">文件扩展名:</span>
					</div>
					<div style="margin-bottom:20px;">
						<select name="createdFileExtNameDropDownList"
							id="createdFileExtNameDropDownList"
							style="border-radius: 3px;width: 10%;height: 22px;">
							<option value=".html">.html</option>
							<option selected="selected" value=".htm">.htm</option>
							<option value=".shtml">.shtml</option>
							<option value=".xml">.xml</option>
							<option value=".json">.json</option>
						</select>
					</div>
				</div>
				<div style="margin-bottom:20px">
					<div style="float:left;">
						<span style="display:block;width:105px;">网页编码:</span>
					</div>
					<div style="margin-bottom:20px;">
						<select name="encode" id="encode">
							<option selected="selected" value="utf-8">Unicode
								(UTF-8)</option>
							<option value="gb2312">简体中文 (GB2312)</option>
							<option value="big5">繁体中文 (Big5)</option>
							<option value="iso-8859-1">西欧 (iso-8859-1)</option>
							<option value="euc-kr">韩文 (euc-kr)</option>
							<option value="euc-jp">日文 (euc-jp)</option>
							<option value="iso-8859-6">阿拉伯文 (iso-8859-6)</option>
							<option value="windows-874">泰文 (windows-874)</option>
							<option value="iso-8859-9">土耳其文 (iso-8859-9)</option>
							<option value="iso-8859-5">西里尔文 (iso-8859-5)</option>
							<option value="iso-8859-8">希伯来文 (iso-8859-8)</option>
							<option value="iso-8859-7">希腊文 (iso-8859-7)</option>
							<option value="windows-1258">越南文 (windows-1258)</option>
							<option value="iso-8859-2">中欧 (iso-8859-2)</option>
						</select>
					</div>
				</div>
				<div style="border: 1px solid #CCC; width:100%">
					<textarea name="Content" rows="2" cols="20" wrap="off" id="Content"
						style="height: 500px; width: 100%; display: none;"></textarea>
				</div>
				<script type="text/javascript">
					editor = CodeMirror.fromTextArea(document
							.getElementById("Content"), {
						lineNumbers : true,
						extraKeys : {
							"Ctrl-Space" : "autocomplete"
						},
						mode : "xml"
					})
					editor.setSize("100%", "540px");
					editor.getValue();//保存到textarea
				</script>
			</form>
		</div>
		<div id="dlg-buttons" style="text-align:center;">
			<a href="javascript:void(0)" class="easyui-linkbutton c6"
				iconCls="icon-ok" onclick="save()" style="width:90px" id="btnSave">保存</a>
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-cancel" onclick="javascript:closeDetailDialog();"
				style="width:90px">返回</a>
		</div>

	</div>

</body>
</html>